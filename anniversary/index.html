<!DOCTYPE html>
<html lang="en">
<!--<![endif]-->
<title>Happy Anniversary</title>

<head>
    <link href="https://fonts.googleapis.com/css?family=Questrial|Raleway" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Pinyon+Script" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
    <link type="text/css" rel="stylesheet" href="styles.css">
    <link rel=" icon " href="../favicon-16x16.png " type="image/x-icon " />
</head>

<body>
    <audio controls preload="auto" id="song" style="display: none"><source src="" type="audio/mpeg">Your browser does not support the audio element.</audio>
    <div id="open-sign">
        <h1 id="open-sign-text">
            Open
        </h1>
    </div>
    <div id="parking-lot">
    </div>
    <div id="diner-interior">
        <div id="mid-wrapper">
            <div class="jukebox-sprite-sheet">
            </div>
        </div>
    </div>

    <!--
<div id="window">
</div>
-->
    <div id="romantic">
        <div id="text-box">
            <h1 class="text">On August 5th, 2017..<span class="end">.</span></h1>
            <h1 class="text">you and I met<span class="end">.</span></h1>
            <h1 class="text">Here's to 12 months..<span class="end">.</span></h1>
            <h1 class="text">...of pure bliss<span class="end">.</span></h1>
        </div>


    </div>

    <div class="doorway">
        <div class="door">
            <div id="lock-plate">
                <span></span><span></span><span></span><span></span>
                <div id="lock-wrapper">
                    <div class="welcome-message">
                        <h2>Oh no, what now...</h2>
                    </div>
                    <div class="lock-dial" id="dial-one">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                    <div class="lock-dial" id="dial-two">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                    <div class="lock-dial" id="dial-three">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                    <div class="lock-dial" id="dial-four">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                    <div class="lock-dial" id="dial-five">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                    <div class="lock-dial" id="dial-six">
                        <ul draggable="true" ondrag="playSound()" data-combo-num="0">
                            <li>5</li>
                            <li>6</li>
                            <li>7</li>
                            <li>8</li>
                            <li>9</li>
                            <li>0</li>
                            <li>1</li>
                            <li>2</li>
                            <li>3</li>
                            <li>4</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var i = 0;
        var txt = "A year ago..";
        var speed = 1000;
        var trackList = ["Ninjoi.%20-%20Misty.mp3", "la-vie-en-rose.mp3", "be-my-baby.mp3", "show-me-that-you-love-me.mp3"];
        var trackTimes = [167, 157, 176, 158]
        var player = document.getElementById("song");
        var songTime = 0;
        var waitTime = 0;

        function musicPlayer(num) {
            player.src = trackList[num];
            player.play();
            songTime = trackTimes[num];
            waitTime = songTime * 1000;
            console.log("Playing: " + player.src + ", " + songTime + " seconds long");
            if (num == 3) {
                window.setTimeout(function() {
                    musicPlayer(0);
                }, waitTime);
            } else {
                window.setTimeout(function() {
                    musicPlayer(num + 1);
                }, waitTime);
            }
        };


        function loadStuff() {
            window.setTimeout(function() {
                $(".text").eq(0).fadeIn(1000);
                $(".text").eq(0).css("display", "flex");
                window.setTimeout(function() {
                    $(".text").eq(0).fadeOut(1000);
                }, 6000);
                window.setTimeout(function() {
                    $(".text").eq(1).fadeIn(1000);
                    $(".text").eq(1).css("display", "flex");
                }, 6600);
                window.setTimeout(function() {
                    $(".text").eq(1).fadeOut(1000);
                }, 10600);
                window.setTimeout(function() {
                    $(".text").eq(2).fadeIn(1000);
                    $(".text").eq(2).css("display", "flex");
                }, 12200);
                window.setTimeout(function() {
                    $(".text").eq(2).fadeOut(1000);
                }, 16200);
                window.setTimeout(function() {
                    $(".text").eq(3).fadeIn(1000);
                    $(".text").eq(3).css("display", "flex");
                }, 18000);
                window.setTimeout(function() {
                    $(".text").eq(3).fadeOut(1000);
                }, 22000)
                window.setTimeout(function() {
                    $("#text-box").fadeOut(1000);
                    $("#container").fadeIn(3000);
                }, 23000);
            }, 1000);
            window.setTimeout(function() {
                $("#diner-interior").fadeIn(1000);
                $("#open-sign").fadeIn(1000);
                $("#parking-lot").fadeIn(1000);
            }, 25000);
            window.setTimeout(function() {
                $("#romantic").css("background", "url('rose-petals-seamless.png') repeat 0 0");
                $("#romantic").css("background-size", "contain");
            }, 25800);
        };

        function sound(src) {
            this.sound = document.createElement("audio");
            this.sound.src = src;
            this.sound.setAttribute("preload", "auto");
            this.sound.setAttribute("controls", "none");
            this.sound.style.display = "none";
            document.body.appendChild(this.sound);
            this.play = function() {
                this.sound.play();
            }
            this.stop = function() {
                this.sound.pause();
            }
        }

        function playSound() {
            tickSound.play();
        }

        function reveal() {
            var songPlayer = document.getElementById("song");
            $(".door").eq(0).css("transform", "rotateY(-45deg)");
            unlockSound.play();
            $(".doorway").eq(0).fadeOut(1200);
            $("body").css("background", "white");
            $("body").css("margin", "0");
            window.setTimeout(function() {
                //          musicPlayer(0);
                //                $("#song").fadeIn(500);
                $("#romantic").fadeIn(1000);
                loadStuff();
            }, 1000);

        }

        $(function() {

            tickSound = new sound("tick.mp3");
            unlockSound = new sound("unlock.mp3");

            var comboArray = [0, 0, 0, 0, 0, 0];
            var combination = [1, 1, 0, 6, 9, 5];

            var gridIncrement = $(".lock-dial ul").css('line-height').replace('px', '') / 2;
            var numNums = $(".lock-dial:eq(0) ul li").length;
            var halfHeight = gridIncrement * numNums;
            var initTop = -(halfHeight - gridIncrement);

            $(".lock-dial ul").css('top', initTop);

            $(".lock-dial ul").draggable({
                grid: [0, gridIncrement],
                axis: 'y',
                drag: function() {
                    var dragDir = $(this).css('top').replace('px', '') < initTop ? "up" : "down";
                    if (dragDir == "up") {
                        var curNum = parseInt($(this).find('li:last-child').text()) + 1;
                        if (curNum < 10) {
                            $(this).append('<li>' + curNum + '</li>');
                        } else {
                            $(this).append('<li>0</li>');
                        };
                    } else {
                        var curNum = parseInt($(this).find('li:first-child').text()) - 1;
                        var thisTop = parseInt($(this).css('margin-top').replace('px', ''));

                        $(this).css({
                            marginTop: thisTop - (gridIncrement * 2)
                        });

                        if (curNum > -1) {
                            $(this).prepend('<li>' + curNum + '</li>');
                        } else {
                            $(this).prepend('<li>9</li>');
                        };
                    };
                },
                stop: function() {

                    //MATHS		
                    var negOrPos = $(this).css('margin-top').replace('px', '') > 0 ? 1 : -1;
                    var thisTopTotal = parseInt($(this).css('top').replace('px', '')) + Math.abs(initTop);
                    var marginMinified = parseInt(Math.abs($(this).css('margin-top').replace('px', ''))) - thisTopTotal;
                    var numIncs = Math.floor(marginMinified / (halfHeight * 2));
                    var totalDif = numIncs * (halfHeight * 2);
                    var topTen = (marginMinified - totalDif) * negOrPos;
                    var activeIndex = Math.abs(topTen / (gridIncrement * 2)) + (halfHeight / (gridIncrement * 2));

                    $(this).attr("data-combo-num", $(this).find('li').eq(activeIndex).text()).css({
                        top: -315,
                        marginTop: topTen
                    }).find('li').slice(20).remove();

                    for (var i = 0; i < $(".lock-dial ul").length; i++) {
                        comboArray[i] = $(".lock-dial ul:eq(" + i + ")").attr("data-combo-num");
                    }


                    if (comboArray == "" + combination) {
                        $('.lock-dial ul').draggable('disable');
                        $('#lock-wrapper').addClass("unlocked");
                        $('.lock-dial').each(function() {
                            var $this = $(this);
                            $this.find('ul').delay(400).css('color', '#0f0').fadeOut(function() {
                                $this.animate({
                                    marginTop: 150
                                }, function() {
                                    $this.fadeOut(function() {
                                        $(".welcome-message").click(reveal);
                                        $('.welcome-message').fadeIn(800);
                                    });
                                });
                            });
                        });
                    }
                }
            });

        })

    </script>
</body>

</html>
